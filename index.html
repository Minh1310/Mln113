<!DOCTYPE html>
<html lang="vi">

<head>
    Â  Â 
    <meta charset="UTF-8">
    Â  Â 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    Â  Â  <title>Chiáº¿n LÆ°á»£c Kiáº¿n Táº¡o: Quyáº¿t Äá»‹nh 10 LÆ°á»£t</title>
    Â  Â  <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef4f7;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .game-container {
            max-width: 1200px;
            margin: auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        h1 {
            color: #004d40;
            text-align: center;
            margin-bottom: 5px;
            font-weight: 800;
        }

        /* CSS Má»šI: Nháº¥n máº¡nh Vai trÃ² vÃ  VÃ¹ng hoáº¡t Ä‘á»™ng */
        .subtitle {
            text-align: center;
            font-style: italic;
            color: #444;
            margin-bottom: 25px;
            font-size: 1.1em;
            padding: 5px 0;
            border-bottom: 2px solid #004d40;
        }

        #game-map {
            background-color: #d1e8e2;
            height: 50px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 50px;
            color: #004d40;
            font-size: 1.4em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 77, 64, 0.2);
        }

        /* Cáº£nh bÃ¡o Ãp lá»±c */
        #tension-alert {
            background-color: #f44336;
            color: white;
            text-align: center;
            padding: 8px;
            margin-bottom: 15px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
        }

        /* II. CHá»ˆ Sá» (STATS) */
        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 15px;
            background-color: #e6f4f8;
            border-radius: 10px;
            border: 1px solid #cceeff;
        }

        .stat-item {
            text-align: center;
            padding: 5px 10px;
            flex-grow: 1;
            border-right: 1px solid #d9d9d9;
        }

        .stat-item:last-child {
            border-right: none;
        }

        .stat-name {
            font-weight: bold;
            font-size: 0.9em;
            color: #00796b;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            color: #004d40;
        }

        /* III. Bá»I Cáº¢NH & THá»¬ THÃCH */
        .challenge-box {
            background-color: #fff3e0;
            padding: 25px;
            border-radius: 10px;
            border-left: 6px solid #ff9800;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .difficulty-tag {
            float: right;
            background-color: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
        }

        /* IV. HÃ€NH Äá»˜NG (Tháº» chÃ­nh sÃ¡ch) */
        .policy-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .policy-card {
            background-color: #4db6ac;
            color: white;
            border: none;
            padding: 15px;
            margin: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            width: 200px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .policy-card:hover {
            background-color: #00796b;
            transform: translateY(-3px);
        }

        .policy-card:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .policy-selection.disabled .policy-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            pointer-events: auto;
        }

        .tooltip {
            visibility: hidden;
            width: 150px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -75px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8em;
            pointer-events: none;
        }

        /* V. POPUP PHáº¢N Há»’I (MODAL) - THÃŠM CSS Má»šI */
        #feedback-modal {
            display: none;
            /* áº¨n theo máº·c Ä‘á»‹nh */
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            /* Ná»n tá»‘i */
        }

        .modal-content {
            background-color: #fefefe;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation-name: animatetop;
            animation-duration: 0.4s;
            overflow: hidden;
            z-index: 1000;
            /* Ä‘áº£m báº£o náº±m trÃªn cÃ¹ng */
        }

        @keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }

            to {
                top: 0;
                opacity: 1
            }
        }

        .feedback-box {
            margin-top: 10px;
            padding: 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .feedback-box strong {
            display: block;
            margin-top: 10px;
            font-size: 0.9em;
            color: #555;
            font-weight: normal;
        }

        .feedback-box .impact {
            font-size: 1.0em;
            margin-top: 15px;
            padding: 5px 0;
            border-top: 1px dashed #ccc;
        }

        .positive {
            background-color: #e8f5e9;
            color: #388e3c;
            border-left: 5px solid #4caf50;
        }

        .negative {
            background-color: #ffebee;
            color: #d32f2f;
            border-left: 5px solid #f44336;
        }

        /* NÃºt tiáº¿p tá»¥c trong Modal */
        .modal-footer {
            text-align: center;
            margin-top: 25px;
        }

        .modal-next-btn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }

        .modal-next-btn:hover {
            background-color: #e68a00;
        }

        /* VI. ÄIá»€U KHIá»‚N & NÃšT NHáº C (Giá»¯ nguyÃªn) */
        #control-panel {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            min-height: 50px;
        }

        .final-result {
            background-color: #e3f2fd;
            border-color: #2196f3;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #90caf9;
        }

        /* CSS cho nÃºt Ä‘iá»u khiá»ƒn nháº¡c */
        #music-control-btn {
            background-color: #004d40;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
            line-height: 1;
        }

        #music-control-btn:hover {
            background-color: #00796b;
        }


        /* 1. Äáº£m báº£o Popup cá»‘ Ä‘á»‹nh (Fixed) vÃ  cÃ³ Ä‘á»‡m dá»c (Top/Bottom Spacing) */
        #welcome-modal,
        #feedback-modal {
            display: none;
            position: fixed;
            /* Ráº¥t quan trá»ng: Giá»¯ cá»‘ Ä‘á»‹nh trong viewport */
            z-index: 101;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.65);
            /* Ná»n tá»‘i hÆ¡n */

            /* Hiá»‡u á»©ng Má»œ (BLUR) cho background */
            backdrop-filter: blur(5px);
            /* LÃ m má» ná»™i dung phÃ­a sau */
            -webkit-backdrop-filter: blur(5px);
            /* Há»— trá»£ trÃ¬nh duyá»‡t Webkit */

            /* CÄƒn giá»¯a báº±ng Flexbox */
            display: flex;
            justify-content: center;
            align-items: center;

            /* 2. Äáº£m báº£o cÃ¡ch Top/Bottom (Sá»­ dá»¥ng padding) */
            padding: 20px;
            /* ThÃªm Ä‘á»‡m 20px xung quanh Ä‘á»ƒ ná»™i dung khÃ´ng cháº¡m mÃ©p */
            box-sizing: border-box;
            /* Quan trá»ng Ä‘á»ƒ padding khÃ´ng lÃ m trÃ n width/height 100% */
            overflow-y: auto;
            /* Cho phÃ©p cuá»™n náº¿u ná»™i dung quÃ¡ dÃ i (Hiáº¿m xáº£y ra) */
        }

        #welcome-modal {
            /* Hiá»‡u á»©ng má»Ÿ Ä‘áº§u sinh Ä‘á»™ng hÆ¡n */
            overflow: hidden;
        }

        /* TÃ¹y chá»‰nh ná»™i dung Modal Welcome */
        #welcome-modal .welcome-container {
            max-width: 550px;
            /* TÄƒng nháº¹ Ä‘á»ƒ cÃ³ khÃ´ng gian */
            padding: 20px;
            border: 3px solid #004d40;
            /* Viá»n ná»•i báº­t */
            position: absolute;
            overflow: auto;
        }

        /* 3. Tá»‘i Æ°u hÃ³a ná»™i dung modal */
        .welcome-container {
            background-color: #fefefe;
            margin: 0;
            padding: 30px;
            border-radius: 12px;
            width: 100%;
            /* DÃ¹ng 100% cá»§a pháº§n tá»­ cha (Ä‘Ã£ cÃ³ padding) */
            max-width: 550px;
            max-height: 500px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            /* Shadow ná»•i báº­t hÆ¡n */

            /* Äáº£m báº£o ná»™i dung khÃ´ng bá»‹ Flexbox co láº¡i */
            flex-shrink: 0;

            /* Hiá»‡u á»©ng má»Ÿ Ä‘áº§u sinh Ä‘á»™ng hÆ¡n */
            animation-name: animatescale;
            animation-duration: 0.5s;
        }

        .welcome-header h2 {
            font-size: 2.2em;
            font-weight: 900;
            color: #ff9800;
            /* MÃ u Cam ná»•i báº­t */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .welcome-role {
            font-size: 1.2em;
            color: #00796b;
            font-style: italic;
            margin-bottom: 25px;
        }

        .welcome-rules h3 {
            color: #d32f2f;
            /* MÃ u Ä‘á» cho Luáº­t */
            border-bottom: 2px dashed #ffebee;
            padding-bottom: 5px;
            margin-top: 20px;
        }

        .welcome-rules ul {
            text-align: left;
            margin-left: 20px;
            list-style-type: 'ğŸ‘‰';
            /* DÃ¹ng emoji cho bullet point */
            padding-left: 10px;
        }

        .welcome-rules ul li {
            padding-left: 10px;
            margin-bottom: 8px;
        }

        .welcome-goal {
            margin-top: 25px;
            padding: 15px;
            background-color: #004d40;
            /* Ná»n xanh Ä‘áº­m */
            color: white;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* NÃºt báº¯t Ä‘áº§u lá»›n hÆ¡n, thu hÃºt hÆ¡n */
        #welcome-modal .modal-next-btn {
            padding: 15px 35px;
            font-size: 1.2em;
            background-color: #ff5722;
            /* MÃ u cam nÃ³ng */
            transition: transform 0.2s;
        }

        #welcome-modal .modal-next-btn:hover {
            background-color: #e64a19;
            transform: scale(1.05);
        }

        /* Cáº­p nháº­t Keyframes */
        @keyframes animatescale {
            from {
                transform: scale(0.8);
                opacity: 0
            }

            to {
                transform: scale(1);
                opacity: 1
            }
        }
    </style>
</head>

<body>

    <audio id="background-music" loop autoplay>
        Â  Â  Â  Â 
        <source src="game_music.mp3" type="audio/mpeg">
        Â  Â  TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ tháº» audio. (Báº¡n cáº§n thay tháº¿ báº±ng file nháº¡c thá»±c táº¿)
    </audio>

    <div class="game-container">
        Â  Â  <h1>CHIáº¾N LÆ¯á»¢C KIáº¾N Táº O: QUYáº¾T Äá»ŠNH 10 LÆ¯á»¢T</h1>
        Â  Â  <p class="subtitle">Báº¡n lÃ  **TrÆ°á»Ÿng Ban Chá»‰ Äáº¡o VÃ¹ng**, giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» DÃ¢n tá»™c vÃ  TÃ´n giÃ¡o (LÆ°á»£t:
            <span id="turn-count-subtitle">1/10</span>)
        </p>
        Â  Â <span id="scroll-location"></span>
        Â  Â  <div id="tension-alert"></span>ğŸ”¥ TÃŒNH HÃŒNH Ná»˜I Bá»˜ ÄANG CÄ‚NG THáº²NG Cá»°C Äá»˜!</div>

        Â  Â  <div class="stats">
            Â  Â  Â  Â  <div class="stat-item">
                <div class="stat-name">LÃ’NG DÃ‚N</div><span id="ld-score" class="stat-value">70</span>
            </div>
            Â  Â  Â  Â  <div class="stat-item">
                <div class="stat-name">Báº¢N Sáº®C VÄ‚N HÃ“A</div><span id="identity-score" class="stat-value">70</span>
            </div>
            Â  Â  Â  Â  <div class="stat-item">
                <div class="stat-name">PHÃT TRIá»‚N Háº  Táº¦NG</div><span id="development-score" class="stat-value">50</span>
            </div>
            Â  Â  Â  Â  <div class="stat-item">
                <div class="stat-name">CÄ‚NG THáº²NG XÃƒ Há»˜I</div><span id="tension-score" class="stat-value">10</span>
            </div>
            Â  Â  </div>

        Â  Â  <div id="game-map">
            Â  Â  Â  Â  <span id="current-zone-display">Äang chuáº©n bá»‹ nháº­n nhiá»‡m vá»¥</span>
            Â  Â  </div>

        Â  Â  <div id="challenge-area">
            Â  Â  </div>

        Â  Â  Â  Â  Â  Â  <div class="policy-selection" id="policy-buttons">
            Â  Â  Â  Â  <h3>Chá»n PhÆ°Æ¡ng Ã¡n Chiáº¿n lÆ°á»£c (Chá»‰ cÃ³ 1 ChÃ­nh sÃ¡ch lÃ  Tá»‘i Æ°u):</h3>
            Â  Â  Â  Â  <div class="policy-options">
                Â  Â  Â  Â  </div>
            Â  Â  </div>

        Â  Â  <div id="control-panel"
            style="position: absolute; top: 0; bottom: 0; margin: 20px; height: fit-content ! important;">
            Â  Â  Â  Â  <button id="music-control-btn" onclick="toggleMusic()">ğŸ”‡ Táº¯t Nháº¡c Ná»n</button>
            Â  Â  Â  Â  Â  Â  </div>
    </div>

    <div id="feedback-modal">
        Â  Â  <div class="modal-content">
            Â  Â  Â  Â  <div id="modal-feedback-content">
                Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
            Â  Â  Â  Â  <div class="modal-footer">
                Â  Â  Â  Â  Â  Â  <button class="modal-next-btn" onclick="nextTurn()">Tiáº¿p tá»¥c LÆ°á»£t sau â–¶ï¸</button>
                Â  Â  Â  Â  </div>
            Â  Â  </div>
    </div>

    <div id="welcome-modal" style="display: none;">
        <div class="modal-content welcome-container">
            <div style="text-align: center;">

                <div class="welcome-header">
                    <h2 style="margin-bottom: 0;">CHIáº¾N LÆ¯á»¢C KIáº¾N Táº O</h2>
                    <p class="welcome-role">Báº¡n LÃ  TrÆ°á»Ÿng Ban Chá»‰ Äáº¡o VÃ¹ng</p>
                </div>

                <p>ChÃ o má»«ng báº¡n! HÃ£y sáºµn sÃ ng Ä‘á»‘i máº·t vá»›i cÃ¡c **ThÃ¡ch thá»©c DÃ¢n tá»™c & TÃ´n giÃ¡o** Ä‘á»ƒ cá»§ng cá»‘ sá»©c máº¡nh ná»™i
                    bá»™ quá»‘c gia.</p>

                <div class="welcome-rules">
                    <h3>ğŸ“œ LUáº¬T CHÆ I & CHá»ˆ Sá» QUAN TRá»ŒNG</h3>
                    <ul>
                        <li>Báº¡n cÃ³ **10 LÆ°á»£t Quyáº¿t Äá»‹nh** (10 tÃ¬nh huá»‘ng khÃ³ khÄƒn).</li>
                        <li>Má»—i lÆ°á»£t, báº¡n pháº£i chá»n **1 ChÃ­nh sÃ¡ch** trong 10 phÆ°Æ¡ng Ã¡n. **Chá»‰ cÃ³ 1 lÃ  Tá»‘i Æ°u!**</li>
                        <li>CÃ¡c chá»‰ sá»‘ chÃ­nh báº¡n cáº§n quáº£n lÃ½: **LÃ²ng DÃ¢n, Báº£n Sáº¯c, PhÃ¡t Triá»ƒn** vÃ  **CÄƒng Tháº³ng XÃ£
                            Há»™i**.</li>
                        <li>**Ãp lá»±c sáº½ tÄƒng dáº§n!** (CÄƒng Tháº³ng tÄƒng 2 Ä‘iá»ƒm má»—i lÆ°á»£t).</li>
                    </ul>
                </div>

                <div class="welcome-goal">
                    <p>Má»¥c tiÃªu: Äáº¡t káº¿t quáº£ **PhÃ¡t Triá»ƒn & LÃ²ng DÃ¢n cao** nháº¥t, Ä‘á»“ng thá»i giá»¯ **CÄƒng Tháº³ng XÃ£ Há»™i <
                            30**!</p>
                </div>

                <div class="modal-footer">
                    <button class="modal-next-btn" onclick="startGameModal()">Báº®T Äáº¦U PHÃ‚N TÃCH VÃ€ RA QUYáº¾T Äá»ŠNH
                        â¡ï¸</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const MAX_TURNS = 10;
        let scores = {
            Ld: 70, // LÃ²ng DÃ¢n
            identity: 70,
            development: 50,
            tension: 10,
            turn: 1,
            canAct: true
        };

        // Khá»Ÿi táº¡o tráº¡ng thÃ¡i nháº¡c
        const music = document.getElementById('background-music');
        const musicBtn = document.getElementById('music-control-btn');
        const feedbackModal = document.getElementById('feedback-modal');
        const modalContent = document.getElementById('modal-feedback-content');

        // --- Khai bÃ¡o chÃ­nh sÃ¡ch Phá»¥ (ÄÆ°á»£c Ä‘Æ°a lÃªn Ä‘áº§u Ä‘á»ƒ truy cáº­p nháº¥t quÃ¡n) ---
        const utilityPolicies = [
            { id: 'policy_hoan', name: 'HoÃ£n Quyáº¿t Äá»‹nh', desc: 'Cáº§n thÃªm thá»i gian nghiÃªn cá»©u. Cháº¥p nháº­n tÃ¬nh hÃ¬nh cÄƒng tháº³ng hÆ¡n.', hover_impact: 'LÃ²ng DÃ¢n â–¼â–¼â–¼, CÄƒng Tháº³ng â–²â–²â–²' },
            { id: 'policy_luc', name: 'Ãp dá»¥ng Biá»‡n phÃ¡p Máº¡nh', desc: 'DÃ¹ng lá»±c lÆ°á»£ng an ninh giáº£i tÃ¡n, báº¯t giá»¯ Ä‘á»‘i tÆ°á»£ng. Giáº£m cÄƒng tháº³ng tá»©c thá»i, nhÆ°ng rá»§i ro cao.', hover_impact: 'LÃ²ng DÃ¢n â–¼â–¼â–¼â–¼, CÄƒng Tháº³ng â–¼â–¼' }
        ];
        window.utilityPolicies = utilityPolicies; // GÃ¡n vÃ o window scope

        // HÃ m Ä‘iá»u khiá»ƒn nháº¡c
        function toggleMusic() {
            if (music.paused) {
                music.play();
                musicBtn.textContent = 'ğŸ”‡ Táº¯t Nháº¡c Ná»n';
            } else {
                music.pause();
                musicBtn.textContent = 'ğŸ”Š Báº­t Nháº¡c Ná»n';
            }
        }

        // --- LÃ GIáº¢I CNXH CHO Má»–I CHÃNH SÃCH ÄÃšNG ---
        const correct_explanations = {
            policy_01: "Giáº£i quyáº¿t nhu cáº§u tinh tháº§n, cá»§ng cá»‘ Ã½ thá»©c dÃ¢n tá»™c. PhÃ¹ há»£p vá»›i chÃ­nh sÃ¡ch Ä‘áº¡i Ä‘oÃ n káº¿t vÃ  phÃ¡t huy giÃ¡ trá»‹ vÄƒn hÃ³a dÃ¢n tá»™c trong CNXH.",
            policy_02: "Äáº£m báº£o quyá»n tá»± do tÃ­n ngÆ°á»¡ng há»£p phÃ¡p. Viá»‡c táº¡o Ä‘iá»u kiá»‡n cho tÃ´n giÃ¡o hoáº¡t Ä‘á»™ng chÃ­nh Ä‘Ã¡ng sáº½ cá»§ng cá»‘ lÃ²ng tin vÃ o phÃ¡p quyá»n XHCN.",
            policy_03: "Cáº¯t Ä‘á»©t nguá»“n gá»‘c mÃ¢u thuáº«n giai cáº¥p. Xá»­ lÃ½ tiÃªu cá»±c vÃ  Ä‘áº£m báº£o phÃ¢n phá»‘i vá»‘n cÃ´ng báº±ng lÃ  nguyÃªn táº¯c cÆ¡ báº£n cá»§a kinh táº¿ XHCN.",
            policy_04: "Báº£o vá»‡ lá»£i Ã­ch vÃ  sá»©c khá»e nhÃ¢n dÃ¢n. Äáº¥u tranh chá»‘ng mÃª tÃ­n dá»‹ Ä‘oan lÃ  báº£o vá»‡ quyá»n lá»£i váº­t cháº¥t vÃ  tinh tháº§n cá»§a quáº§n chÃºng, cá»§ng cá»‘ ná»n táº£ng vÄƒn hÃ³a XHCN.",
            policy_05: "Báº£o tá»“n báº£n sáº¯c lÃ  báº£o tá»“n sá»©c máº¡nh ná»™i sinh. Äáº§u tÆ° vÃ o giÃ¡o dá»¥c song ngá»¯ lÃ  giáº£i phÃ¡p lÃ¢u dÃ i, phÃ¹ há»£p vá»›i chÃ­nh sÃ¡ch bÃ¬nh Ä‘áº³ng vÃ  Ä‘oÃ n káº¿t dÃ¢n tá»™c.",
            policy_06: "NguyÃªn táº¯c cao nháº¥t lÃ  lá»£i Ã­ch nhÃ¢n dÃ¢n. CÃ´ng khai giáº£i quyáº¿t tranh cháº¥p Ä‘áº¥t Ä‘ai qua Ä‘á»‘i thoáº¡i Ä‘a chiá»u lÃ  thá»±c hiá»‡n quyá»n lÃ m chá»§ cá»§a nhÃ¢n dÃ¢n, cá»§ng cá»‘ phÃ¡p luáº­t XHCN.",
            policy_07: "Chá»§ Ä‘á»™ng thÃ´ng tin lÃ  báº£o vá»‡ chá»§ quyá»n. BÃ¡c bá» luáº­n Ä‘iá»‡u xuyÃªn táº¡c báº±ng sá»± tháº­t quá»‘c táº¿ lÃ  Ä‘áº¥u tranh chÃ­nh trá»‹ sáº¯c bÃ©n, báº£o vá»‡ uy tÃ­n NhÃ  nÆ°á»›c XHCN.",
            policy_08: "HÃ i hÃ²a lá»£i Ã­ch. Thiáº¿t láº­p cÆ¡ cháº¿ Ä‘á»“ng quáº£n lÃ½ giÃºp táº­n dá»¥ng nguá»“n lá»±c xÃ£ há»™i Ä‘á»ƒ phÃ¡t triá»ƒn vÄƒn hÃ³a trong khi NhÃ  nÆ°á»›c váº«n kiá»ƒm soÃ¡t tÃ­nh phÃ¡p lÃ½ vÃ  lá»‹ch sá»­.",
            policy_09: "Má»m dáº»o chÃ­nh trá»‹, cá»©ng ráº¯n phÃ¡p lÃ½. Giáº£i quyáº¿t táº­n gá»‘c rá»… (kinh táº¿, an sinh) káº¿t há»£p Ä‘áº¥u tranh phÃ¡p lÃ½ vá»›i lá»±c lÆ°á»£ng cá»±c Ä‘oan, thá»ƒ hiá»‡n tÃ­nh Æ°u viá»‡t cá»§a chÃ­nh sÃ¡ch dÃ¢n tá»™c XHCN.",
            policy_10: "Minh báº¡ch vÃ  NhÃ¢n vÄƒn. TÃ¡i Ä‘á»‹nh cÆ° nhÃ¢n vÄƒn, cÃ´ng khai, vÃ  Ä‘áº£m báº£o sinh káº¿ lÃ  Æ°u tiÃªn tuyá»‡t Ä‘á»‘i khi thá»±c hiá»‡n cÃ¡c dá»± Ã¡n phÃ¡t triá»ƒn kinh táº¿ quá»‘c gia XHCN."
        };

        // --- 10 TÃŒNH HUá»NG Vá»šI LOGIC ÄIá»‚M ÄÃƒ Tá»I Æ¯U ---
        const all_challenges = [
            // LÆ°á»£ng cá»™ng giáº£m, LÆ°á»£ng trá»« náº¿u fail sáº½ lá»›n hÆ¡n
            {
                id: 1, zone: 'Miá»n nÃºi phÃ­a Báº¯c (LÃ o Cai)', difficulty: 1,
                text: "Má»™t nhÃ³m nghá»‡ nhÃ¢n TÃ y Ä‘á» xuáº¥t há»£p tÃ¡c vá»›i Sá»Ÿ VÄƒn hÃ³a Ä‘á»ƒ phá»¥c há»“i Lá»… há»™i *Lá»“ng Tá»“ng* bá»‹ mai má»™t. Há» yÃªu cáº§u 500 triá»‡u Ä‘á»“ng kinh phÃ­ há»— trá»£ vÃ  lo ngáº¡i Lá»… há»™i sáº½ bá»‹ 'thÆ°Æ¡ng máº¡i hÃ³a' vÃ  máº¥t Ä‘i Ã½ nghÄ©a gá»‘c náº¿u NhÃ  nÆ°á»›c can thiá»‡p sÃ¢u.",
                correct_policy: 'policy_01',
                effect_success: { Ld: 3, identity: 6, tension: -2 }, // TÄƒng Ã­t hÆ¡n
                effect_fail_base: { Ld: -6, identity: -8, tension: 5 } // Base fail effect
            },

            {
                id: 2, zone: 'Äá»“ng báº±ng SÃ´ng Há»“ng (Nam Äá»‹nh)', difficulty: 2,
                text: "GiÃ¡o xá»© X (CÃ´ng giÃ¡o) Ä‘Ã£ Ä‘Æ°á»£c cáº¥p phÃ©p muá»‘n má»Ÿ rá»™ng khuÃ´n viÃªn Ä‘á»ƒ xÃ¢y nhÃ  Má»¥c vá»¥ do sá»‘ giÃ¡o dÃ¢n tÄƒng. Tuy nhiÃªn, há» bá»‹ vÆ°á»›ng máº¯c vÃ¬ giÃ¡ Ä‘á»n bÃ¹ giáº£i tá»a hÃ nh lang an toÃ n giao thÃ´ng chÆ°a thá»a Ä‘Ã¡ng, gÃ¢y khiáº¿u náº¡i kÃ©o dÃ i.",
                correct_policy: 'policy_02',
                effect_success: { Ld: 4, development: 2, tension: -4 },
                effect_fail_base: { Ld: -8, tension: 7 }
            },

            {
                id: 3, zone: 'TÃ¢y NguyÃªn (Äáº¯k Láº¯k)', difficulty: 3,
                text: "50 há»™ dÃ¢n ÃŠ-ÄÃª tá»‘ cÃ¡o 3 cÃ¡n bá»™ tÃ­n dá»¥ng vÃ  Ä‘á»‹a chÃ­nh Ä‘Ã£ 'Äƒn cháº·n' vá»‘n vay Æ°u Ä‘Ã£i (50 triá»‡u/há»™) phÃ¡t triá»ƒn cÃ¢y cÃ´ng nghiá»‡p. Vá»¥ viá»‡c Ä‘ang gÃ¢y bá»©c xÃºc lá»›n, Ä‘e dá»a lÃ²ng tin vÃ o chÃ­nh sÃ¡ch xÃ³a Ä‘Ã³i giáº£m nghÃ¨o cá»§a tá»‰nh.",
                correct_policy: 'policy_03',
                effect_success: { Ld: 5, development: 3, tension: -5 },
                effect_fail_base: { Ld: -10, tension: 9, development: -2 }
            },

            {
                id: 4, zone: 'Miá»n Trung (Quáº£ng Trá»‹)', difficulty: 4,
                text: "TÃ  Ä‘áº¡o 'PhÃºc Láº¡c' lan truyá»n trong vÃ¹ng sÃ¢u, khuyáº¿n khÃ­ch tÃ­n Ä‘á»“ khÃ´ng tiÃªm phÃ²ng cho con cÃ¡i vÃ  khÃ´ng dÃ¹ng thuá»‘c TÃ¢y. TÃ¬nh hÃ¬nh dá»‹ch bá»‡nh gia tÄƒng, vÃ  ngÆ°á»i dÃ¢n bá»‹ buá»™c Ä‘Ã³ng 'lá»… váº­t' tá»‘n kÃ©m. Cáº§n can thiá»‡p gáº¥p.",
                correct_policy: 'policy_04',
                effect_success: { tension: -6, Ld: 4 },
                effect_fail_base: { Ld: -8, tension: 10 }
            },

            {
                id: 5, zone: 'VÃ¹ng nÃ´ng thÃ´n Báº¯c Bá»™ (Báº¯c Giang)', difficulty: 5,
                text: "Kháº£o sÃ¡t cho tháº¥y nhiá»u thanh thiáº¿u niÃªn bá» há»c sá»›m Ä‘á»ƒ Ä‘i lÃ m xa, khiáº¿n má»‘i liÃªn káº¿t giá»¯a cha máº¹ vÃ  con cÃ¡i suy yáº¿u, gia tÄƒng báº¡o lá»±c gia Ä‘Ã¬nh vÃ  ly hÃ´n. ChÃ­nh quyá»n Ä‘á»‹a phÆ°Æ¡ng muá»‘n phá»¥c há»“i giÃ¡ trá»‹ 'Gia Ä‘Ã¬nh vÄƒn hÃ³a má»›i XHCN'.",
                correct_policy: 'policy_05',
                effect_success: { identity: 5, Ld: 4, tension: -3 },
                effect_fail_base: { identity: -8, Ld: -5, tension: 6 }
            },

            {
                id: 6, zone: 'Miá»n Trung (Quáº£ng Nam)', difficulty: 6,
                text: "Phá»¥ ná»¯ trong cÃ¡c lÃ ng nghá» truyá»n thá»‘ng Ã­t Ä‘Æ°á»£c tham gia quáº£n lÃ½ há»£p tÃ¡c xÃ£, dÃ¹ chiáº¿m hÆ¡n 60% lao Ä‘á»™ng. Nhiá»u Ã½ kiáº¿n Ä‘á» xuáº¥t cÃ³ chÃ­nh sÃ¡ch nÃ¢ng cao vai trÃ² phá»¥ ná»¯ vÃ  bÃ¬nh Ä‘áº³ng giá»›i trong phÃ¡t triá»ƒn kinh táº¿ há»™ gia Ä‘Ã¬nh.",
                correct_policy: 'policy_06',
                effect_success: { development: 4, Ld: 5, tension: -4 },
                effect_fail_base: { Ld: -8, development: -3, tension: 6 }
            },

            {
                id: 7, zone: 'TÃ¢y NguyÃªn (Kon Tum)', difficulty: 7,
                text: "Má»™t sá»‘ vÃ¹ng dÃ¢n tá»™c thiá»ƒu sá»‘ xuáº¥t hiá»‡n trÃ o lÆ°u thanh niÃªn bá» quÃª lÃªn thÃ nh phá»‘ lÃ m thuÃª, Ä‘á»ƒ láº¡i tráº» em vÃ  ngÆ°á»i giÃ  khÃ´ng Ä‘Æ°á»£c chÄƒm sÃ³c. ChÃ­nh quyá»n cáº§n biá»‡n phÃ¡p á»•n Ä‘á»‹nh kinh táº¿ há»™ vÃ  giá»¯ gÃ¬n náº¿p sá»‘ng gia Ä‘Ã¬nh truyá»n thá»‘ng.",
                correct_policy: 'policy_07',
                effect_success: { Ld: 6, development: 3, tension: -5 },
                effect_fail_base: { Ld: -9, tension: 7 }
            },

            {
                id: 8, zone: 'ÄÃ´ thá»‹ lá»›n (HÃ  Ná»™i)', difficulty: 8,
                text: "Sá»± bÃ¹ng ná»• cÃ´ng nghá»‡ vÃ  máº¡ng xÃ£ há»™i khiáº¿n nhiá»u gia Ä‘Ã¬nh máº¥t gáº¯n káº¿t, tráº» em lá»‡ thuá»™c vÃ o Internet, xa rá»i giÃ¡o dá»¥c Ä‘áº¡o Ä‘á»©c truyá»n thá»‘ng. Cáº§n má»™t chÆ°Æ¡ng trÃ¬nh xÃ¢y dá»±ng 'Gia Ä‘Ã¬nh sá»‘ â€“ VÄƒn hÃ³a sá»‘ XHCN' phÃ¹ há»£p thá»i Ä‘áº¡i.",
                correct_policy: 'policy_08',
                effect_success: { Ld: 5, identity: 4, tension: -4 },
                effect_fail_base: { Ld: -8, identity: -6, tension: 6 }
            },

            {
                id: 9, zone: 'TÃ¢y Báº¯c (Äiá»‡n BiÃªn)', difficulty: 9,
                text: "NhÃ³m ngÆ°á»i MÃ´ng bá»‹ tá»• chá»©c 'GiÃª SÃ¹a' lÃ´i kÃ©o tuyÃªn truyá»n vá» viá»‡c ly khai. NhÃ³m nÃ y vÅ© trang, chiáº¿m giá»¯ má»™t Ä‘á»“n nhá» cá»§a BiÃªn phÃ²ng. Cáº§n xá»­ lÃ½ kháº©n cáº¥p Ä‘á»ƒ khÃ´ng táº¡o tiá»n lá»‡ xáº¥u vÃ  khÃ´ng gÃ¢y Ä‘á»• mÃ¡u.",
                correct_policy: 'policy_09',
                effect_success: { Ld: 8, tension: -8, identity: 2 },
                effect_fail_base: { Ld: -15, tension: 15 }
            },

            {
                id: 10, zone: 'Miá»n Trung (Khu kinh táº¿ ven biá»ƒn)', difficulty: 10,
                text: "Dá»± Ã¡n Khu kinh táº¿ quá»‘c gia (3000ha) pháº£i thu há»“i Ä‘áº¥t cá»§a 500 há»™ dÃ¢n tá»™c ChÄƒm, bao gá»“m viá»‡c di dá»i 3 thÃ¡nh Ä‘Æ°á»ng Há»“i giÃ¡o vÃ  hÃ ng loáº¡t nghÄ©a Ä‘á»‹a. NgÆ°á»i dÃ¢n pháº£n Ä‘á»‘i, cho ráº±ng viá»‡c di dá»i lÃ m tá»•n thÆ°Æ¡ng tinh tháº§n tÃ´n giÃ¡o vÃ  báº£n sáº¯c.",
                correct_policy: 'policy_10',
                effect_success: { development: 7, Ld: 6, tension: -7, identity: 1 },
                effect_fail_base: { development: -5, Ld: -14, tension: 18 }
            }
        ];

        // --- 10 CHÃNH SÃCH Cá»¤ THá»‚ TÆ¯Æ NG á»¨NG ---
        const policies = [
            { id: 'policy_01', name: 'Äá»“ng tÃ i trá»£ & Kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng', desc: 'NhÃ  nÆ°á»›c chia sáº» 70% kinh phÃ­, nhÆ°ng thiáº¿t láº­p Ban GiÃ¡m sÃ¡t (CÆ¡ quan VÄƒn hÃ³a & Nghá»‡ nhÃ¢n) Ä‘á»ƒ Ä‘áº£m báº£o cháº¥t lÆ°á»£ng, chá»‘ng thÆ°Æ¡ng máº¡i hÃ³a.', hover_impact: 'LÃ²ng DÃ¢n â–²â–², Báº£n Sáº¯c â–²â–²â–², CÄƒng Tháº³ng â–¼' },
            { id: 'policy_02', name: 'Tá»• cÃ´ng tÃ¡c Æ°u tiÃªn thÃ¡o gá»¡', desc: 'ThÃ nh láº­p Tá»• cÃ´ng tÃ¡c liÃªn ngÃ nh Ä‘áº·c biá»‡t Ä‘á»ƒ Æ°u tiÃªn xá»­ lÃ½ há»“ sÆ¡, Ã¡p dá»¥ng khung giÃ¡ Ä‘á»n bÃ¹ cao nháº¥t vÃ  Ä‘á» xuáº¥t phÆ°Æ¡ng Ã¡n hoÃ¡n Ä‘á»•i Ä‘áº¥t há»£p lÃ½.', hover_impact: 'LÃ²ng DÃ¢n â–²â–²â–², PhÃ¡t Triá»ƒn â–², CÄƒng Tháº³ng â–¼â–¼' },
            { id: 'policy_03', name: 'Thanh tra Ä‘á»™t xuáº¥t & Khá»Ÿi tá»‘', desc: 'Khá»Ÿi tá»‘ vÃ  xá»­ lÃ½ hÃ¬nh sá»± cÃ¡n bá»™ tham nhÅ©ng; tá»• chá»©c thanh tra Ä‘á»™t xuáº¥t vÃ  tÃ¡i cÆ¡ cáº¥u ban quáº£n lÃ½ vá»‘n vay Ä‘á»ƒ tráº£ láº¡i quyá»n lá»£i cho ngÆ°á»i dÃ¢n.', hover_impact: 'LÃ²ng DÃ¢n â–²â–²â–², PhÃ¡t Triá»ƒn â–², CÄƒng Tháº³ng â–¼â–¼' },
            { id: 'policy_04', name: 'LiÃªn ngÃ nh Y táº¿ - An ninh', desc: 'Xá»­ lÃ½ nghiÃªm Ä‘á»‘i tÆ°á»£ng cáº§m Ä‘áº§u theo phÃ¡p luáº­t; phá»‘i há»£p Y táº¿ vÃ  chá»©c sáº¯c tÃ´n giÃ¡o chÃ­nh thá»‘ng tuyÃªn truyá»n khoa há»c vá» y táº¿ vÃ  Ä‘áº¥u tranh vá»›i mÃª tÃ­n dá»‹ Ä‘oan.', hover_impact: 'CÄƒng Tháº³ng â–¼â–¼â–¼, LÃ²ng DÃ¢n â–²â–²' },
            {
                id: 'policy_05', name: 'ChÆ°Æ¡ng trÃ¬nh Gia Ä‘Ã¬nh VÄƒn hÃ³a XHCN',
                desc: 'PhÃ¡t Ä‘á»™ng phong trÃ o â€œGia Ä‘Ã¬nh vÄƒn hÃ³a â€“ Háº¡nh phÃºc â€“ BÃ¬nh Ä‘áº³ngâ€ vá»›i trá»ng tÃ¢m giÃ¡o dá»¥c Ä‘áº¡o Ä‘á»©c, phÃ²ng chá»‘ng báº¡o lá»±c vÃ  khÃ´i phá»¥c cÃ¡c giÃ¡ trá»‹ truyá»n thá»‘ng trong Ä‘á»i sá»‘ng hiá»‡n Ä‘áº¡i.',
                hover_impact: 'Báº£n Sáº¯c â–²â–², LÃ²ng DÃ¢n â–²â–², CÄƒng Tháº³ng â–¼'
            },
            {
                id: 'policy_06', name: 'Chiáº¿n lÆ°á»£c BÃ¬nh Ä‘áº³ng giá»›i trong Kinh táº¿ há»™ gia Ä‘Ã¬nh',
                desc: 'ÄÆ°a tiÃªu chÃ­ bÃ¬nh Ä‘áº³ng giá»›i vÃ o xáº¿p háº¡ng Há»£p tÃ¡c xÃ£; Æ°u tiÃªn tÃ­n dá»¥ng vÃ  Ä‘Ã o táº¡o lÃ£nh Ä‘áº¡o cho phá»¥ ná»¯, kháº³ng Ä‘á»‹nh vai trÃ² â€œngÆ°á»i giá»¯ lá»­aâ€ trong phÃ¡t triá»ƒn kinh táº¿ â€“ xÃ£ há»™i XHCN.',
                hover_impact: 'PhÃ¡t Triá»ƒn â–²â–², LÃ²ng DÃ¢n â–²â–², CÄƒng Tháº³ng â–¼'
            },
            {
                id: 'policy_07', name: 'ChÃ­nh sÃ¡ch Há»— trá»£ Lao Ä‘á»™ng Trá»Ÿ vá» QuÃª',
                desc: 'Táº¡o viá»‡c lÃ m táº¡i chá»—, má»Ÿ lá»›p dáº¡y nghá» cho thanh niÃªn nÃ´ng thÃ´n; há»— trá»£ kinh táº¿ há»™ gia Ä‘Ã¬nh nháº±m gáº¯n káº¿t tháº¿ há»‡ vÃ  á»•n Ä‘á»‹nh cáº¥u trÃºc gia Ä‘Ã¬nh vÃ¹ng dÃ¢n tá»™c thiá»ƒu sá»‘.',
                hover_impact: 'LÃ²ng DÃ¢n â–²â–²â–², PhÃ¡t Triá»ƒn â–², CÄƒng Tháº³ng â–¼â–¼'
            },
            {
                id: 'policy_08', name: 'Äá» Ã¡n Gia Ä‘Ã¬nh sá»‘ â€“ VÄƒn hÃ³a sá»‘ XHCN',
                desc: 'Tá»• chá»©c chiáº¿n dá»‹ch truyá»n thÃ´ng vÃ  hÆ°á»›ng dáº«n â€œGia Ä‘Ã¬nh 4.0â€ â€“ á»©ng dá»¥ng cÃ´ng nghá»‡ vÃ o gáº¯n káº¿t, giÃ¡o dá»¥c con cÃ¡i, vÃ  lan tá»a lá»‘i sá»‘ng XHCN trong khÃ´ng gian máº¡ng.',
                hover_impact: 'LÃ²ng DÃ¢n â–²â–², Báº£n Sáº¯c â–²â–², CÄƒng Tháº³ng â–¼'
            }, { id: 'policy_09', name: 'Lá»“ng ghÃ©p An ninh - An sinh xÃ£ há»™i', desc: 'Thá»±c hiá»‡n chÃ­nh sÃ¡ch an sinh xÃ£ há»™i kháº©n cáº¥p (nhÃ  á»Ÿ, viá»‡c lÃ m) Ä‘á»ƒ tÃ¡ch Ä‘á»‘i tÆ°á»£ng bá»‹ lÃ´i kÃ©o ra khá»i Ä‘á»‘i tÆ°á»£ng cáº§m Ä‘áº§u; Ä‘á»“ng thá»i sá»­ dá»¥ng lá»±c lÆ°á»£ng An ninh Ä‘áº¥u tranh phÃ¡p lÃ½ kiÃªn quyáº¿t.', hover_impact: 'LÃ²ng DÃ¢n â–²â–²â–², CÄƒng Tháº³ng â–¼â–¼â–¼' },
            { id: 'policy_10', name: 'Minh báº¡ch Quy trÃ¬nh TÃ¡i Ä‘á»‹nh cÆ° NhÃ¢n vÄƒn', desc: 'CÃ´ng khai toÃ n bá»™ quy trÃ¬nh; Ã¡p dá»¥ng chÃ­nh sÃ¡ch Ä‘á»n bÃ¹ cao nháº¥t; xÃ¢y dá»±ng khu tÃ¡i Ä‘á»‹nh cÆ° má»›i gáº§n gÅ©i vá»›i phong tá»¥c ChÄƒm, Ä‘áº£m báº£o sinh káº¿ tá»‘t hÆ¡n nÆ¡i cÅ©.', hover_impact: 'PhÃ¡t Triá»ƒn â–²â–²â–², LÃ²ng DÃ¢n â–²â–²â–², CÄƒng Tháº³ng â–¼â–¼â–¼' }
        ];


        function updateScores() {
            document.getElementById('turn-count-subtitle').textContent = `${scores.turn}/${MAX_TURNS}`;
            document.getElementById('ld-score').textContent = scores.Ld;
            document.getElementById('identity-score').textContent = scores.identity;
            document.getElementById('development-score').textContent = scores.development;
            document.getElementById('tension-score').textContent = scores.tension;

            // Cáº­p nháº­t Cáº£nh bÃ¡o Ãp lá»±c
            const alertBox = document.getElementById('tension-alert');
            if (scores.tension >= 70) {
                alertBox.style.display = 'block';
                alertBox.style.backgroundColor = '#8c0000'; // Äá» ráº¥t Ä‘áº­m (Nguy hiá»ƒm)
                alertBox.textContent = "ğŸ”¥ğŸ”¥ KHá»¦NG HOáº¢NG LÃ’NG TIN VÃ€ AN NINH TRáº¬T Tá»°! ğŸ”¥ğŸ”¥";
            } else if (scores.tension >= 50) {
                alertBox.style.display = 'block';
                alertBox.style.backgroundColor = '#d32f2f'; // Äá»
                alertBox.textContent = "ğŸ”¥ TÃŒNH HÃŒNH Ná»˜I Bá»˜ ÄANG CÄ‚NG THáº²NG Cá»°C Äá»˜! ğŸ”¥";
            } else if (scores.tension >= 30) {
                alertBox.style.display = 'block';
                alertBox.style.backgroundColor = '#ff9800'; // Cam
                alertBox.textContent = "âš ï¸ Cáº£nh bÃ¡o: Ãp lá»±c xÃ£ há»™i Ä‘ang gia tÄƒng nhanh chÃ³ng.";
            } else {
                alertBox.style.display = 'none';
            }
        }

        function startTurn() {
            if (scores.turn > MAX_TURNS) {
                displayFinalResult();
                return;
            }

            scores.canAct = true;

            // Ãp lá»±c xÃ£ há»™i tÄƒng 2 Ä‘iá»ƒm má»—i lÆ°á»£t (TÄƒng Ä‘á»™ khÃ³)
            scores.tension += 2;

            const currentChallengeIndex = scores.turn - 1;
            currentChallenge = all_challenges[currentChallengeIndex];
            const correctPolicy = policies.find(p => p.id === currentChallenge.correct_policy);


            // Cáº­p nháº­t giao diá»‡n
            document.getElementById('current-zone-display').textContent = `Äang Ä‘iá»u hÃ nh táº¡i VÃ¹ng ${currentChallenge.zone}`;
            document.getElementById('challenge-area').innerHTML = `
            <div class="challenge-box" id="current-challenge-box">
                <span class="difficulty-tag">Äá»™ KhÃ³: ${currentChallenge.difficulty}/10</span>
                <h4>âš ï¸ Váº¥n Ä‘á» PhÃ¡t sinh (LÆ°á»£t ${scores.turn})</h4>
                <p><strong>Khu vá»±c: ${currentChallenge.zone}</strong></p>
                <p>${currentChallenge.text}</p>
                <p style="font-style: italic; color: #cc6600;">Thá»i gian khÃ´ng cÃ²n nhiá»u. HÃ£y chá»n ChÃ­nh sÃ¡ch Tá»‘i Æ°u nháº¥t.</p>
            </div>
        `;

            feedbackModal.style.display = 'none'; // Äáº£m báº£o Modal Ä‘Ã³ng
            document.getElementById('policy-buttons').classList.remove('disabled');

            // Cáº­p nháº­t danh sÃ¡ch chÃ­nh sÃ¡ch cho lÆ°á»£t hiá»‡n táº¡i
            updatePolicyButtons(correctPolicy);

            updateScores();
        }

        function updatePolicyButtons(correctPolicy) {
            const policyButtonsContainer = document.querySelector('.policy-options');
            let policyHTML = '';

            // Tá»‘i Æ°u hÃ³a Logic Trá»™n ChÃ­nh sÃ¡ch (Äáº£m báº£o 1 Ä‘Ãºng, 2 phá»¥, 7 sai)
            const allPolicyIds = policies.map(p => p.id);

            // 1. Lá»c ra cÃ¡c chÃ­nh sÃ¡ch SAI (trá»« chÃ­nh sÃ¡ch Ä‘Ãºng)
            const wrongPolicyIds = allPolicyIds.filter(id => id !== correctPolicy.id);

            // 2. Chá»n 7 chÃ­nh sÃ¡ch sai ngáº«u nhiÃªn
            const randomWrongPolicies = wrongPolicyIds
                .sort(() => 0.5 - Math.random())
                .slice(0, 7)
                .map(id => policies.find(p => p.id === id));

            // 3. Táº¡o danh sÃ¡ch 10 chÃ­nh sÃ¡ch (1 Ä‘Ãºng + 2 phá»¥ + 7 sai)
            let currentTurnPolicies = [correctPolicy, ...randomWrongPolicies, ...utilityPolicies];
            currentTurnPolicies.sort(() => 0.5 - Math.random()); // XÃ¡o trá»™n cuá»‘i cÃ¹ng

            currentTurnPolicies.forEach(policy => {
                policyHTML += `
                <div class="policy-card" onclick="handleDecision('${policy.id}')">
                    <h5>${policy.name}</h5>
                    <p>${policy.desc}</p>
                    <div class="tooltip">${policy.hover_impact || 'Dá»± kiáº¿n: LÃ²ng DÃ¢n ?, CÄƒng Tháº³ng ?'}</div>
                </div>
            `;
            });

            policyButtonsContainer.innerHTML = policyHTML;
        }

        function scrollToTop() {
            const element = document.getElementById("scroll-location");
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth', // smooth scrolling
                    block: 'start'      // align to the top of the element
                });
            } else {
                console.warn(`Element with id "${elementId}" not found.`);
            }
        }


        function handleDecision(selectedPolicyId) {
            if (!currentChallenge || !scores.canAct || scores.turn > MAX_TURNS) return;

            scores.canAct = false;
            scrollToTop();
            const isCorrect = selectedPolicyId === currentChallenge.correct_policy;
            let feedbackHTML = '';
            let effects;

            // Gá»™p táº¥t cáº£ chÃ­nh sÃ¡ch Ä‘á»ƒ tÃ¬m tÃªn
            const allPolicies = [...policies, ...utilityPolicies];
            const selectedPolicy = allPolicies.find(p => p.id === selectedPolicyId);

            if (isCorrect) {
                effects = currentChallenge.effect_success;
            } else if (selectedPolicyId === 'policy_hoan') {
                // TÃ¡c Ä‘á»™ng HoÃ£n: Giáº£m LÃ²ng DÃ¢n (-5), TÄƒng CÄƒng Tháº³ng (10)
                effects = { tension: 10, Ld: -5 };
            } else if (selectedPolicyId === 'policy_luc') {
                // TÃ¡c Ä‘á»™ng Lá»±c LÆ°á»£ng: Giáº£m LÃ²ng DÃ¢n (-12), Giáº£m CÄƒng Tháº³ng (-5)
                effects = { tension: -5, Ld: -12, identity: -4 };
            } else {
                // Hiá»‡u á»©ng tháº¥t báº¡i
                effects = currentChallenge.effect_fail_base;
                effects.development = (effects.development || 0) - 3;
            }

            // Táº¡o thÃ´ng bÃ¡o chi tiáº¿t
            const detailEffects = [
                effects.Ld ? `LÃ²ng DÃ¢n ${effects.Ld > 0 ? 'â•' : 'â–'}${Math.abs(effects.Ld)}` : '',
                effects.identity ? `Báº£n Sáº¯c ${effects.identity > 0 ? 'â•' : 'â–'}${Math.abs(effects.identity)}` : '',
                effects.development ? `PhÃ¡t Triá»ƒn ${effects.development > 0 ? 'â•' : 'â–'}${Math.abs(effects.development)}` : '',
                effects.tension ? `CÄƒng Tháº³ng ${effects.tension > 0 ? 'â•' : 'â–'}${Math.abs(effects.tension)}` : '',
            ].filter(e => e).join('; ');

            // Logic Feedback
            if (isCorrect) {
                feedbackHTML = `<div class="feedback-box positive">
                <h2>âœ… QUYáº¾T Äá»ŠNH XUáº¤T Sáº®C!</h2>
                <p>ChÃ­nh sÃ¡ch **"${selectedPolicy.name}"** lÃ  Tá»‘i Æ°u vÃ  ChÃ­nh xÃ¡c.</p>
                <div class="impact">TÃ¡c Ä‘á»™ng: ${detailEffects}</div>
                <strong>LÃ½ giáº£i theo CNXH:</strong> ${correct_explanations[selectedPolicyId]}
            </div>`;
            } else if (selectedPolicyId === 'policy_hoan') {
                feedbackHTML = `<div class="feedback-box negative">
                <h2>âŒ QUYáº¾T Äá»ŠNH Bá»Š ÄÃŒNH TRá»†!</h2>
                <p>HoÃ£n khÃ´ng pháº£i lÃ  giáº£i phÃ¡p, váº¥n Ä‘á» trá»Ÿ nÃªn phá»©c táº¡p hÆ¡n.</p>
                <div class="impact">TÃ¡c Ä‘á»™ng: ${detailEffects}</div>
                <strong>LÃ½ giáº£i theo CNXH:</strong> TÃ¬nh hÃ¬nh ná»™i bá»™ khÃ´ng cho phÃ©p trÃ¬ hoÃ£n. Thiáº¿u quyáº¿t Ä‘oÃ¡n lÃ m máº¥t lÃ²ng tin vÃ  tÄƒng Ã¡p lá»±c xÃ£ há»™i.
            </div>`;
            } else if (selectedPolicyId === 'policy_luc') {
                feedbackHTML = `<div class="feedback-box negative">
                <h2>âŒ BIá»†N PHÃP QUÃ Máº NH!Â </h2>
                <p>Máº·c dÃ¹ giáº£m cÄƒng tháº³ng, nhÆ°ng hÃ nh Ä‘á»™ng nÃ y gÃ¢y tá»•n thÆ°Æ¡ng lá»›n Ä‘áº¿n LÃ²ng DÃ¢n vÃ  Báº£n Sáº¯c.</p>
                <div class="impact">TÃ¡c Ä‘á»™ng: ${detailEffects}</div>
                <strong>LÃ½ giáº£i theo CNXH:</strong> Giáº£i quyáº¿t mÃ¢u thuáº«n cáº§n káº¿t há»£p biá»‡n phÃ¡p hÃ nh chÃ­nh vá»›i dÃ¢n váº­n, kinh táº¿. Chá»‰ dÃ¹ng vÅ© lá»±c lÃ  Ä‘i ngÆ°á»£c láº¡i nguyÃªn táº¯c NhÃ  nÆ°á»›c cá»§a dÃ¢n.
            </div>`;
            } else {
                feedbackHTML = `<div class="feedback-box negative">
                <h2>âŒ QUYáº¾T Äá»ŠNH CHÆ¯A Tá»I Æ¯U!</h2>
                <p>ChÃ­nh sÃ¡ch **"${selectedPolicy.name}"** khÃ´ng phÃ¹ há»£p, lÃ m tÃ¬nh hÃ¬nh tráº§m trá»ng thÃªm.</p>
                <div class="impact">TÃ¡c Ä‘á»™ng: ${detailEffects}</div>
                <strong>LÃ½ giáº£i theo CNXH:</strong> Quyáº¿t Ä‘á»‹nh nÃ y khÃ´ng giáº£i quyáº¿t gá»‘c rá»… mÃ¢u thuáº«n giai cáº¥p, kinh táº¿ hoáº·c tinh tháº§n, khiáº¿n Ä‘á»‘i tÆ°á»£ng pháº£n á»©ng tiÃªu cá»±c.
            </div>`;
            }

            // Cáº­p nháº­t Ä‘iá»ƒm
            scores.Ld += effects.Ld || 0;
            scores.identity += effects.identity || 0;
            scores.development += effects.development || 0;
            scores.tension += effects.tension || 0;

            // Giá»›i háº¡n Ä‘iá»ƒm (0-100)
            scores.Ld = Math.max(0, Math.min(100, scores.Ld));
            scores.identity = Math.max(0, Math.min(100, scores.identity));
            scores.development = Math.max(0, Math.min(100, scores.development));
            scores.tension = Math.max(0, scores.tension);

            // Hiá»ƒn thá»‹ Modal/Popup
            modalContent.innerHTML = feedbackHTML;
            feedbackModal.style.display = 'block';

            document.getElementById('policy-buttons').classList.add('disabled');
            currentChallenge = null;
            updateScores();
            document.body.style.overflow = 'hidden'; // NgÄƒn cuá»™n trang khi Modal má»Ÿ
        }

        function nextTurn() {
            feedbackModal.style.display = 'none'; // ÄÃ³ng Modal
            document.body.style.overflow = 'visible'; // Cho phÃ©p cuá»™n trang trá»Ÿ láº¡i
            scores.turn++;
            if (scores.turn > MAX_TURNS) {
                document.getElementById('game-map').style.display = 'none';
                scores.turn--;
                displayFinalResult();
            } else {
                startTurn();
            }
        }

        function displayFinalResult() {
            let finalMessage = "ğŸ† **Káº¾T THÃšC HÃ€NH TRÃŒNH KIáº¾N Táº O!** ";
            let grade;

            if (scores.Ld >= 85 && scores.identity >= 65 && scores.tension <= 25) {
                grade = "TUYá»†T Vá»œI (A+)";
                finalMessage += "Báº¡n Ä‘Ã£ hoÃ n thÃ nh xuáº¥t sáº¯c nhiá»‡m vá»¥ Kiáº¿n táº¡o. XÃ£ há»™i Ä‘áº¡t má»©c hÃ²a há»£p cao, phÃ¡t triá»ƒn toÃ n diá»‡n, LÃ²ng DÃ¢n vá»¯ng cháº¯c!";
            } else if (scores.Ld >= 70 && scores.tension <= 40) {
                grade = "Äáº T YÃŠU Cáº¦U (B)";
                finalMessage += "Báº¡n Ä‘Ã£ quáº£n lÃ½ tá»‘t. Tuy nhiÃªn, má»™t vÃ i quyáº¿t Ä‘á»‹nh chÆ°a tá»‘i Æ°u Ä‘Ã£ lÃ m giáº£m Ä‘Ã  phÃ¡t triá»ƒn vÃ  LÃ²ng DÃ¢n.";
            } else {
                grade = "Cáº¦N Cáº¢I THIá»†N (C)";
                finalMessage += "Má»©c Ä‘á»™ cÄƒng tháº³ng xÃ£ há»™i cao vÃ  LÃ²ng DÃ¢n giáº£m máº¡nh. Cáº§n xem xÃ©t láº¡i cÃ¡c nguyÃªn táº¯c chÃ­nh sÃ¡ch cÆ¡ báº£n!";
            }

            document.getElementById('challenge-area').innerHTML = `
            <div class="final-result">
                <h4>Káº¾T QUáº¢ CUá»I CÃ™NG: ${grade}</h4>
                <p>${finalMessage}</p>
                <hr>
                <p>LÃ²ng DÃ¢n: **${scores.Ld}**</p>
                <p>Báº£n sáº¯c VÄƒn hÃ³a: **${scores.identity}**</p>
                <p>PhÃ¡t triá»ƒn Háº¡ táº§ng: **${scores.development}**</p>
                <p>CÄƒng Tháº³ng XÃ£ Há»™i: **${scores.tension}**</p>
                <hr style="margin-top: 20px;">              
                <button class="modal-next-btn" onclick="restartGame()" style="background-color: #2196f3; font-size: 1.2em;">
                    CHÆ I Láº I Tá»ª Äáº¦U ğŸ”„
                </button>
            </div>
        `;
            document.getElementById('policy-buttons').style.display = 'none';
            document.getElementById('control-panel').style.display = 'none';
            document.getElementById('tension-alert').style.display = 'none';
            feedbackModal.style.display = 'none'; // ÄÃ³ng Modal láº§n cuá»‘i
            updateScores();
        }

        function restartGame() {
            // Reset táº¥t cáº£ chá»‰ sá»‘ vá» tráº¡ng thÃ¡i ban Ä‘áº§u
            scores = {
                Ld: 70,
                identity: 70,
                development: 50,
                tension: 10,
                turn: 1,
                canAct: true
            };

            // Hiá»‡n láº¡i cÃ¡c khu vá»±c bá»‹ áº©n khi káº¿t thÃºc
            document.getElementById('game-map').style.display = 'block';
            document.getElementById('policy-buttons').style.display = 'block';
            document.getElementById('control-panel').style.display = 'flex';
            document.getElementById('tension-alert').style.display = 'none';

            // Dá»n dáº¹p káº¿t quáº£ cuá»‘i cÃ¹ng
            document.getElementById('challenge-area').innerHTML = '';

            // Báº¯t Ä‘áº§u láº¡i trÃ² chÆ¡i (sáº½ hiá»ƒn thá»‹ Modal Welcome)
            initializeGame();
        }

        function startGameModal() {
            document.getElementById('welcome-modal').style.display = 'none';
            music.play();
            startTurn(); // Báº¯t Ä‘áº§u lÆ°á»£t Ä‘áº§u tiÃªn sau khi Ä‘Ã³ng popup
        }

        // --- Khá»Ÿi táº¡o Giao diá»‡n ChÃ­nh sÃ¡ch vÃ  TrÃ² chÆ¡i ---
        function initializeGame() {
            window.policy_names = policies.reduce((acc, policy) => {
                acc[policy.id] = policy.name;
                return acc;
            }, {});

            // Thá»­ phÃ¡t nháº¡c láº§n Ä‘áº§u
            const playPromise = music.play();

            // Báº­t Modal Welcome
            document.getElementById('welcome-modal').style.display = 'flex'; // Sá»­ dá»¥ng 'flex'

            // Äáº£m báº£o Modal Feedback áº©n
            feedbackModal.style.display = 'none';
        }

        initializeGame();
    </script>

</body>

</html>